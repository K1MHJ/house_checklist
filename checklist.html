<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>住宅検査チェックリスト</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      vertical-align: top;
    }
    th {
      background-color: #f2f2f2;
    }
    .photo-gallery {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding-top: 5px;
      max-width: 100%;
    }
    .photo-gallery::-webkit-scrollbar {
      height: 8px;
    }
    .photo-gallery::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 4px;
    }
    .photo-item {
      flex: 0 0 auto;
      text-align: center;
    }
    .photo-item img {
      max-width: 120px;
      max-height: 100px;
      display: block;
      margin-bottom: 4px;
      cursor: pointer;
    }
    .download-button, .delete-button {
      display: block;
      font-size: 0.75em;
      margin: 2px 0;
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
    .modal img {
      max-width: 90vw;
      max-height: 90vh;
    }
  </style>
</head>
<body>
  <h1>住宅検査チェックリスト</h1>
  <table id="checklist">
    <thead>
      <tr>
        <th>番号</th>
        <th>空間</th>
        <th>項目</th>
        <th>事項</th>
        <th>チェック</th>
        <th>写真</th>
      </tr>
    </thead>
    <tbody id="checklist-body"></tbody>
  </table>

  <div id="imageModal" class="modal" onclick="this.style.display='none'">
    <img id="modalImage" src="" alt="拡大画像">
  </div>

  <script>
    const checklist = [
  {
    "number": 1,
    "space": "玄関",
    "item": "ドア",
    "detail": "ドアの開閉はスムーズで、固くないか？"
  },
  {
    "number": 2,
    "space": "玄関",
    "item": "ドア",
    "detail": "ドアロック（鍵、電子式など）は正常に作動しているか？"
  },
  {
    "number": 3,
    "space": "玄関",
    "item": "ドア",
    "detail": "ドアを半分開いた状態で止めた際に自然に動いてしまわないか確認。"
  },
  {
    "number": 4,
    "space": "玄関",
    "item": "ドア",
    "detail": "水平器でドア枠の上部と下部を確認する。"
  },
  {
    "number": 5,
    "space": "玄関",
    "item": "ドア",
    "detail": "気密ゴムパッキンが正しく取り付けられているか？"
  },
  {
    "number": 6,
    "space": "玄関",
    "item": "ドア",
    "detail": "ドア枠とドアの隙間に建築誤差はないか。段差なく床に密着しているか？（隙間確認）"
  },
  {
    "number": 7,
    "space": "玄関",
    "item": "床仕上げ",
    "detail": "タイル（または石材）の施工状態（浮き、ひび割れ、汚れ）は問題ないか？"
  },
  {
    "number": 8,
    "space": "玄関",
    "item": "床仕上げ",
    "detail": "傾斜（排水勾配）は適切か？水溜まりはないか？"
  },
  {
    "number": 9,
    "space": "玄関",
    "item": "床仕上げ",
    "detail": "タイルの目地仕上げは均一か？"
  },
  {
    "number": 10,
    "space": "玄関",
    "item": "床仕上げ",
    "detail": "水平器で床を確認し、外側への若干の傾斜があるか確認する。"
  },
  {
    "number": 11,
    "space": "玄関",
    "item": "玄関壁",
    "detail": "垂直かどうか確認する。"
  },
  {
    "number": 12,
    "space": "玄関",
    "item": "靴箱・収納",
    "detail": "収納棚の扉の開閉に問題はないか？"
  },
  {
    "number": 13,
    "space": "玄関",
    "item": "靴箱・収納",
    "detail": "蝶番の音や緩みがないか？"
  },
  {
    "number": 14,
    "space": "玄関",
    "item": "靴箱・収納",
    "detail": "収納棚の内部仕上げ（傷、浮き）の状態確認"
  },
  {
    "number": 15,
    "space": "玄関",
    "item": "靴箱・収納",
    "detail": "水平器を使用、または目視で傾きを確認する。"
  },
  {
    "number": 16,
    "space": "玄関",
    "item": "照明・スイッチ",
    "detail": "センサー照明の動作確認（自動点灯機能がある場合）"
  },
  {
    "number": 17,
    "space": "玄関",
    "item": "照明・スイッチ",
    "detail": "手動照明スイッチの動作確認"
  },
  {
    "number": 18,
    "space": "玄関",
    "item": "照明・スイッチ",
    "detail": "照明のちらつき、誤作動がないか"
  },
  {
    "number": 19,
    "space": "玄関",
    "item": "雨水・防水構造",
    "detail": "軒、雨よけ構造物の設置状態確認"
  },
  {
    "number": 20,
    "space": "玄関",
    "item": "雨水・防水構造",
    "detail": "雨の日に外部の水が室内に吹き込まない構造であるかを確認"
  },
  {
    "number": 21,
    "space": "玄関",
    "item": "雨水・防水構造",
    "detail": "シリコン仕上げ（ドア周囲）の隙間がないか"
  },
  {
    "number": 22,
    "space": "玄関",
    "item": "防犯・安全",
    "detail": "ドアチェーン、ドアビューア（覗き穴）の動作確認"
  },
  {
    "number": 23,
    "space": "玄関",
    "item": "防犯・安全",
    "detail": "警報センサー設置の有無（設置されている場合は動作確認）"
  },
  {
    "number": 24,
    "space": "玄関",
    "item": "サーモグラフィ（熱画像検査）",
    "detail": "サーモグラフィ撮影"
  },
  {
    "number": 25,
    "space": "玄関",
    "item": "靴箱設置および仕上げ状態",
    "detail": "傷やドア開閉の異常の有無を確認"
  },
  {
    "number": 26,
    "space": "玄関",
    "item": "床断熱・防湿",
    "detail": "床の湿気確認（手で触れて湿気が感じられないか確認）"
  },
  {
    "number": 27,
    "space": "LD, 部屋",
    "item": "床仕上げ材",
    "detail": "傷、浮き、水平の確認"
  },
  {
    "number": 28,
    "space": "LD, 部屋",
    "item": "照明およびスイッチの位置",
    "detail": "図面との一致、動作確認"
  },
  {
    "number": 29,
    "space": "LD, 部屋",
    "item": "コンセントの位置および個数",
    "detail": "図面との一致確認"
  },
  {
    "number": 30,
    "space": "LD, 部屋",
    "item": "壁の状態",
    "detail": "浮き、気泡がなく、色褪せしていないか"
  },
  {
    "number": 31,
    "space": "LD, 部屋",
    "item": "床の水平",
    "detail": "複数箇所に水平器を置いて傾きを確認する"
  },
  {
    "number": 32,
    "space": "LD, 部屋",
    "item": "床材の仕上げ",
    "detail": "傷、打痕の有無を確認"
  },
  {
    "number": 33,
    "space": "LD, 部屋",
    "item": "床材の仕上げ",
    "detail": "木材タイル接合部の段差や隙間の確認"
  },
  {
    "number": 34,
    "space": "LD, 部屋",
    "item": "床材の弾性・騒音",
    "detail": "歩行時に異音がないか（ギシギシ音、揺れ感）"
  },
  {
    "number": 35,
    "space": "LD, 部屋",
    "item": "床材の弾性・騒音",
    "detail": "歩行時に異音がないか（ポンポン音、スプリングのような弾む感覚）"
  },
  {
    "number": 36,
    "space": "LD, 部屋",
    "item": "断熱",
    "detail": "床の冷え（手で感じるか、サーモグラフィーで確認）"
  },
  {
    "number": 37,
    "space": "LD, 部屋",
    "item": "断熱",
    "detail": "床の湿気を確認"
  },
  {
    "number": 38,
    "space": "LD, 部屋",
    "item": "ドア仕上げ",
    "detail": "ドア枠とドアの間の隙間を確認"
  },
  {
    "number": 39,
    "space": "LD, 部屋",
    "item": "ドア仕上げ",
    "detail": "ドア枠の水平・垂直を確認"
  },
  {
    "number": 40,
    "space": "窓",
    "item": "開閉時の問題の有無",
    "detail": "窓がスムーズに開閉できるか確認"
  },
  {
    "number": 41,
    "space": "窓",
    "item": "開閉時の問題の有無",
    "detail": "閉じた後に正しくロックされるか確認"
  },
  {
    "number": 42,
    "space": "窓",
    "item": "窓枠の水平・垂直状態",
    "detail": "水平器で窓の上部・下部・垂直度を確認する"
  },
  {
    "number": 43,
    "space": "窓",
    "item": "気密性・断熱性の確認",
    "detail": "窓を閉めた状態で隙間風が入るかテストする（紙、手のひら、ろうそくの火を使ったテスト）"
  },
  {
    "number": 44,
    "space": "窓",
    "item": "気密性・断熱性の確認",
    "detail": "ゴムパッキンが外れたり潰れたりしていないか確認"
  },
  {
    "number": 45,
    "space": "窓",
    "item": "気密性・断熱性の確認",
    "detail": "窓ガラスと枠の間のシリコンの抜けやひび割れを確認"
  },
  {
    "number": 46,
    "space": "窓",
    "item": "水漏れ防止（防水状態）",
    "detail": "窓枠の下部に水跡・カビ・漏水跡がないかを確認（雨の後または窓の下部）"
  },
  {
    "number": 47,
    "space": "窓",
    "item": "水漏れ防止（防水状態）",
    "detail": "シリコン（コーキング）仕上げの状態を確認（隙間や割れがないか）"
  },
  {
    "number": 48,
    "space": "窓",
    "item": "水漏れ防止（防水状態）",
    "detail": "排水穴が詰まっていないか、排水がスムーズかを確認"
  },
  {
    "number": 49,
    "space": "窓",
    "item": "窓ガラス自体の状態",
    "detail": "複層ガラス（ペアガラス）の場合、二重ガラスの間に曇りがないか確認"
  },
  {
    "number": 50,
    "space": "窓",
    "item": "網戸",
    "detail": "網戸がスムーズに動作するか（引っ掛かりや破れがないか）確認"
  },
  {
    "number": 51,
    "space": "キッチン",
    "item": "キッチンシンク",
    "detail": "水栓の動作確認 → 冷水・温水がしっかり出るか確認"
  },
  {
    "number": 52,
    "space": "キッチン",
    "item": "キッチンシンク",
    "detail": "水栓から水漏れやグラつきがないかを確認"
  },
  {
    "number": 53,
    "space": "キッチン",
    "item": "キッチンシンク",
    "detail": "シンクに傷や打痕がないか確認"
  },
  {
    "number": 54,
    "space": "キッチン",
    "item": "キッチンシンク",
    "detail": "排水口の水がスムーズに流れるか確認 → 逆流や悪臭がないか"
  },
  {
    "number": 55,
    "space": "キッチン",
    "item": "キッチンシンク",
    "detail": "排水ホースおよびトラップの接続状態を確認（下部収納棚を開けて確認）"
  },
  {
    "number": 56,
    "space": "キッチン",
    "item": "キッチンシンク",
    "detail": "シンク下の収納棚内部に水気・カビ・臭いがないか確認"
  },
  {
    "number": 57,
    "space": "キッチン",
    "item": "ガスレンジ",
    "detail": "作動テスト（点火確認またはIH電源確認）"
  },
  {
    "number": 58,
    "space": "キッチン",
    "item": "ガスレンジ",
    "detail": "すべてのコンロの正常動作を確認"
  },
  {
    "number": 59,
    "space": "キッチン",
    "item": "ガスレンジ",
    "detail": "ガス漏れ検知器の有無確認（ガスの場合）"
  },
  {
    "number": 60,
    "space": "キッチン",
    "item": "ガスレンジ",
    "detail": "IH調理器の操作ボタンの反応速度、タイマー等オプションの正常動作を確認"
  },
  {
    "number": 61,
    "space": "キッチン",
    "item": "換気扇（フード）",
    "detail": "電源を入れた際の動作確認"
  },
  {
    "number": 62,
    "space": "キッチン",
    "item": "換気扇（フード）",
    "detail": "風量の強・弱切り替え機能の確認"
  },
  {
    "number": 63,
    "space": "キッチン",
    "item": "換気扇（フード）",
    "detail": "換気扇の騒音が異常に大きくないか確認"
  },
  {
    "number": 64,
    "space": "キッチン",
    "item": "換気扇（フード）",
    "detail": "油受けフィルターの設置状態、ぐらつきがないか確認"
  },
  {
    "number": 65,
    "space": "キッチン",
    "item": "換気扇（フード）",
    "detail": "外部排気口（外フード）から実際に排気されているかを確認"
  },
  {
    "number": 66,
    "space": "キッチン",
    "item": "調理台（ワークトップ）および収納棚",
    "detail": "キッチン天板に傷や破損がないか確認"
  },
  {
    "number": 67,
    "space": "キッチン",
    "item": "調理台（ワークトップ）および収納棚",
    "detail": "キッチン天板と壁の間のシリコン仕上げ状態（隙間がないか確認）"
  },
  {
    "number": 68,
    "space": "キッチン",
    "item": "調理台（ワークトップ）および収納棚",
    "detail": "引き出しや収納棚の扉がスムーズに開閉できるか確認"
  },
  {
    "number": 69,
    "space": "キッチン",
    "item": "調理台（ワークトップ）および収納棚",
    "detail": "収納棚内部に異物や仕上げの異常がないか確認"
  },
  {
    "number": 70,
    "space": "キッチン",
    "item": "調理台（ワークトップ）および収納棚",
    "detail": "ソフトクローズ機能がある場合、正常に動作するか確認"
  },
  {
    "number": 71,
    "space": "キッチン",
    "item": "照明およびコンセント",
    "detail": "キッチン専用照明のスイッチ動作を確認"
  },
  {
    "number": 72,
    "space": "キッチン",
    "item": "照明およびコンセント",
    "detail": "作業台上部・壁面のコンセントの数量および位置が図面と一致しているか確認"
  },
  {
    "number": 73,
    "space": "キッチン",
    "item": "照明およびコンセント",
    "detail": "コンセントに正常に電源が供給されているか確認"
  },
  {
    "number": 74,
    "space": "キッチン",
    "item": "床および壁の仕上げ",
    "detail": "床タイル・フローリング材等に損傷や接合不良がないか確認"
  },
  {
    "number": 75,
    "space": "キッチン",
    "item": "床および壁の仕上げ",
    "detail": "キッチン壁のタイル（またはパネル）に汚れ・傷・隙間がないか確認"
  },
  {
    "number": 76,
    "space": "キッチン",
    "item": "床および壁の仕上げ",
    "detail": "防水処理が施された壁材かを確認（特にシンク周辺）"
  },
  {
    "number": 77,
    "space": "キッチン",
    "item": "その他",
    "detail": "ゴミ箱収納口、自動引き出し、食器洗浄機などのオプション有無を確認"
  },
  {
    "number": 78,
    "space": "キッチン",
    "item": "その他",
    "detail": "オプション仕様（特殊天板、取っ手、上部棚など）が図面と一致しているか確認"
  },
  {
    "number": 79,
    "space": "トイレ",
    "item": "トイレ設置状態",
    "detail": "トイレが水平に固定されているか、シリコン仕上げ状態やぐらつきがないか確認"
  },
  {
    "number": 80,
    "space": "トイレ",
    "item": "給水・排水の確認",
    "detail": "水を流した際の水圧が適切か、排水遅延・逆流がないか、水タンクからの水漏れがないか確認"
  },
  {
    "number": 81,
    "space": "トイレ",
    "item": "床・壁・天井の状態",
    "detail": "タイルや床材に隙間・浮きがないか、壁紙・天井にカビ・漏水跡がないか確認"
  },
  {
    "number": 82,
    "space": "トイレ",
    "item": "臭気・換気",
    "detail": "悪臭がないか、換気扇の動作確認、換気窓の開閉と網戸を確認"
  },
  {
    "number": 83,
    "space": "トイレ",
    "item": "照明・電気設備",
    "detail": "照明スイッチの動作、コンセントの防水性、ウォシュレットの動作確認（設置されている場合）"
  },
  {
    "number": 84,
    "space": "トイレ",
    "item": "騒音・振動",
    "detail": "排水時の騒音が過度ではないか、2階のトイレ使用時に1階への振動や音の伝わりがないか確認"
  },
  {
    "number": 85,
    "space": "トイレ",
    "item": "漏水確認（1階天井）",
    "detail": "2階のトイレ使用時に1階の天井に漏水跡、水滴、湿気の痕跡がないか確認"
  },
  {
    "number": 86,
    "space": "トイレ",
    "item": "配管の振動・騒音",
    "detail": "排水時の配管が壁内で響いたり、1階に振動や音が伝わらないか確認"
  },
  {
    "number": 87,
    "space": "トイレ",
    "item": "床防水処理",
    "detail": "床タイル・床材の隙間、シリコン仕上げ、排水勾配など防水施工状態の確認"
  },
  {
    "number": 88,
    "space": "トイレ",
    "item": "排水口の状態",
    "detail": "水の排水が良好で、逆流や悪臭がないか、トラップが設置されているか確認"
  },
  {
    "number": 89,
    "space": "トイレ",
    "item": "下部点検口の内部",
    "detail": "浴室・トイレ天井に点検口がある場合は、内部の湿気、結露、カビの状態を確認"
  },
  {
    "number": 90,
    "space": "トイレ",
    "item": "通気・換気性能",
    "detail": "換気扇の動作、外部への排気が適切か、窓の換気機能の動作確認"
  },
  {
    "number": 91,
    "space": "バスルーム",
    "item": "浴槽・洗面台",
    "detail": "浴槽と壁・床との間のシリコン仕上げ状態を確認 → 隙間や割れがないか"
  },
  {
    "number": 92,
    "space": "バスルーム",
    "item": "浴槽・洗面台",
    "detail": "洗面台の排水確認 → 排水がスムーズであるか"
  },
  {
    "number": 93,
    "space": "バスルーム",
    "item": "浴槽・洗面台",
    "detail": "浴槽や洗面台に水を溜めた際、下部からの水漏れがないか確認（下部の点検口を開いて確認）"
  },
  {
    "number": 94,
    "space": "バスルーム",
    "item": "蛇口・シャワー",
    "detail": "冷水・温水の切り替えがスムーズで自然に動作するか確認"
  },
  {
    "number": 95,
    "space": "バスルーム",
    "item": "蛇口・シャワー",
    "detail": "シャワーヘッドから均一に水が出るか、固定がしっかりしているか確認"
  },
  {
    "number": 96,
    "space": "バスルーム",
    "item": "蛇口・シャワー",
    "detail": "シャワーホースに曲がりや亀裂がないか確認"
  },
  {
    "number": 97,
    "space": "バスルーム",
    "item": "蛇口・シャワー",
    "detail": "水圧が強すぎたり弱すぎたりしないか確認"
  },
  {
    "number": 98,
    "space": "バスルーム",
    "item": "排水・下水システム",
    "detail": "排水口に水が溜まらず、排水速度が適切か確認"
  },
  {
    "number": 99,
    "space": "バスルーム",
    "item": "排水・下水システム",
    "detail": "排水時に「ゴボゴボ」音や逆流、臭いがないか確認"
  },
  {
    "number": 100,
    "space": "バスルーム",
    "item": "排水・下水システム",
    "detail": "排水トラップが正常に設置されているか確認（下部点検口から確認）"
  },
  {
    "number": 101,
    "space": "バスルーム",
    "item": "排水・下水システム",
    "detail": "床に適度な傾斜がついているか（水がスムーズに流れるか）確認"
  },
  {
    "number": 102,
    "space": "バスルーム",
    "item": "フロア・壁・天井",
    "detail": "タイル・パネル間の目地が均一に施工されているか確認"
  },
  {
    "number": 103,
    "space": "バスルーム",
    "item": "フロア・壁・天井",
    "detail": "シリコンが抜けていないか（特に角部分を確認）"
  },
  {
    "number": 104,
    "space": "バスルーム",
    "item": "フロア・壁・天井",
    "detail": "壁・床・天井にカビ・水跡・色移りがないか確認"
  },
  {
    "number": 105,
    "space": "バスルーム",
    "item": "フロア・壁・天井",
    "detail": "浴室天井の点検口内部に湿気やカビがないか確認"
  },
  {
    "number": 106,
    "space": "バスルーム",
    "item": "浴室ドア・ドア枠",
    "detail": "ドアの開閉がスムーズで密閉性が良好か確認"
  },
  {
    "number": 107,
    "space": "バスルーム",
    "item": "浴室ドア・ドア枠",
    "detail": "ドア下部に水が溜まらず、乾燥状態を維持しているか確認"
  },
  {
    "number": 108,
    "space": "バスルーム",
    "item": "浴室ドア・ドア枠",
    "detail": "ドア周囲のシリコン仕上げに隙間や割れがないか確認"
  },
  {
    "number": 109,
    "space": "バスルーム",
    "item": "浴室ドア・ドア枠",
    "detail": "ドア枠の木部に湿気による変色や広がりがないか確認"
  },
  {
    "number": 110,
    "space": "バスルーム",
    "item": "換気システム",
    "detail": "換気扇が正常に動作しているか確認"
  },
  {
    "number": 111,
    "space": "バスルーム",
    "item": "換気システム",
    "detail": "タイマーや自動モードなどの機能がある場合、その動作確認"
  },
  {
    "number": 112,
    "space": "バスルーム",
    "item": "換気システム",
    "detail": "外部排気口から実際に空気が排出されているか確認"
  },
  {
    "number": 113,
    "space": "バスルーム",
    "item": "換気システム",
    "detail": "換気窓の開閉可能性および網戸の設置を確認"
  },
  {
    "number": 114,
    "space": "バスルーム",
    "item": "その他のオプションおよび設備",
    "detail": "オートバス動作テスト"
  },
  {
    "number": 115,
    "space": "バスルーム",
    "item": "その他のオプションおよび設備",
    "detail": "浴室暖房乾燥機の動作確認"
  },
  {
    "number": 116,
    "space": "バスルーム",
    "item": "その他のオプションおよび設備",
    "detail": "照明スイッチ、防水コンセント確認"
  },
  {
    "number": 117,
    "space": "屋根裏",
    "item": "断熱材の施工状態",
    "detail": "断熱材の施工確認"
  },
  {
    "number": 118,
    "space": "屋根裏",
    "item": "結露・湿気の有無",
    "detail": "湿気・カビの確認"
  },
  {
    "number": 119,
    "space": "屋根裏",
    "item": "木材部材の状態",
    "detail": "構造材確認"
  },
  {
    "number": 120,
    "space": "屋根裏",
    "item": "漏水跡",
    "detail": "水漏れ跡確認"
  },
  {
    "number": 121,
    "space": "屋根裏",
    "item": "工事残材",
    "detail": "異物放置確認"
  },
  {
    "number": 122,
    "space": "屋根裏",
    "item": "配線の状態",
    "detail": "電線整理確認"
  },
  {
    "number": 123,
    "space": "屋根裏",
    "item": "換気の状態",
    "detail": "換気口の確認"
  },
  {
    "number": 124,
    "space": "屋根裏",
    "item": "配管類の確認",
    "detail": "ファンダクト確認"
  },
  {
    "number": 125,
    "space": "屋根裏",
    "item": "断熱と換気の共存（通気の確保）",
    "detail": "断熱材が換気経路を塞いでいないか確認"
  },
  {
    "number": 126,
    "space": "屋根裏",
    "item": "害虫・ネズミの痕跡",
    "detail": "害虫やネズミの痕跡確認"
  }
    ];

    const savedState = JSON.parse(localStorage.getItem("checklistState") || "{}");
    const savedPhotos = JSON.parse(localStorage.getItem("checklistPhotosMulti") || "{}");
    const tbody = document.getElementById("checklist-body");
    const modal = document.getElementById("imageModal");
    const modalImage = document.getElementById("modalImage");

    function initChecklist() {
      checklist.forEach(row => {
        const tr = document.createElement("tr");
        ["number", "space", "item", "detail"].forEach(key => {
          const td = document.createElement("td");
          td.textContent = row[key];
          tr.appendChild(td);
        });

        const checkboxTd = document.createElement("td");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = savedState[row.number] || false;
        checkbox.addEventListener("change", (e) => {
          savedState[row.number] = e.target.checked;
          localStorage.setItem("checklistState", JSON.stringify(savedState));
        });
        checkboxTd.appendChild(checkbox);
        tr.appendChild(checkboxTd);

        const photoTd = document.createElement("td");
        const photoButton = document.createElement("button");
        photoButton.textContent = "📷 撮影";

        const photoContainer = document.createElement("div");
        photoContainer.className = "photo-gallery";

        function renderPhotos() {
          photoContainer.innerHTML = "";
          const photoList = savedPhotos[row.number] || [];
          photoList.forEach((src, index) => {
            const item = document.createElement("div");
            item.className = "photo-item";

            const img = document.createElement("img");
            img.src = src;
            img.addEventListener("click", () => {
              modalImage.src = src;
              modal.style.display = "flex";
            });

            const downloadLink = document.createElement("a");
            downloadLink.textContent = `📥 保存${index + 1}`;
            downloadLink.className = "download-button";
            downloadLink.href = src;
            downloadLink.download = `photo_${row.number}_${index + 1}.jpg`;

            const deleteButton = document.createElement("span");
            deleteButton.textContent = "🗑️ 削除";
            deleteButton.className = "delete-button";
            deleteButton.addEventListener("click", () => {
              savedPhotos[row.number].splice(index, 1);
              localStorage.setItem("checklistPhotosMulti", JSON.stringify(savedPhotos));
              renderPhotos();
            });

            item.appendChild(img);
            item.appendChild(downloadLink);
            item.appendChild(deleteButton);
            photoContainer.appendChild(item);
          });
        }

        renderPhotos();

        photoButton.addEventListener("click", async () => {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { width: { ideal: 9999 }, height: { ideal: 9999 } } });
            const video = document.createElement("video");
            video.srcObject = stream;
            await video.play();

            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const base64data = canvas.toDataURL("image/jpeg");
            if (!savedPhotos[row.number]) savedPhotos[row.number] = [];
            savedPhotos[row.number].push(base64data);
            localStorage.setItem("checklistPhotosMulti", JSON.stringify(savedPhotos));

            renderPhotos();

            stream.getTracks().forEach(track => track.stop());
          } catch (error) {
            alert("カメラにアクセスできませんでした: " + error);
          }
        });

        photoTd.appendChild(photoButton);
        photoTd.appendChild(photoContainer);
        tr.appendChild(photoTd);

        tbody.appendChild(tr);
      });
    }

    initChecklist();
  </script>
</body>
</html>
